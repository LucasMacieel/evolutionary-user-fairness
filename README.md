# User-oriented Fairness in Recommendation

This repository includes the implementation for User-oriented Fairness in Recommendation, based on:

*Yunqi Li, Hanxiong Chen, Zuohui Fu, Yingqiang Ge, and Yongfeng Zhang. 2021. User-oriented Fairness in Recommendation. In Proceedings of the Web Conference 2021 (WWW'21).*

## Features

This implementation extends the original work with:

- **MILP Solver** (`model.py`): Mixed Integer Linear Programming solver using PuLP with HiGHS/CBC backends
- **Genetic Algorithm Optimizer** (`ga_optimizer.py`): Vectorized GA with:
  - Adaptive penalty mechanism (Bean & Hadj-Alouane method)
  - Tournament selection with Deb's feasibility rules
- **Hyperparameter Tuning** (`ga_hyperparameter_tuning.py`): Optuna-based TPE optimization
- **Statistical Evaluation** (`ga_statistical_evaluation.py`): Multi-run statistical analysis (30 runs by default)

## Project Status

### âœ… Completed Components

| Component | Status | Description |
|-----------|--------|-------------|
| MILP Solver | âœ… Complete | PuLP-based solver with HiGHS/CBC backends, warm start support |
| GA Optimizer | âœ… Complete | Vectorized NumPy implementation, adaptive penalty (Bean & Hadj-Alouane), Deb's feasibility rules |
| Hyperparameter Tuning | âœ… Complete | Optuna TPE optimization with pruning and caching |
| Statistical Evaluation | âœ… Complete | 30-run analysis with 95% CI, IQR, and convergence tracking |
| Visualization | âœ… Complete | Convergence plots, solver comparison, statistical summaries |

### ðŸ“Š Experimental Results

Results are available for the following configurations:

- **Models**: NCF, biasedMF
- **Datasets**: 5Beauty-rand (Amazon)
- **Groupings**: count, max_price, sum_price
- **Solvers**: HiGHS, CBC (MILP) + GA

Statistical evaluation results include:
- Mean, standard deviation, median
- 95% confidence intervals
- Inter-quartile range (IQR)
- Success rate metrics

### ðŸ”§ Key GA Features

- **Perturbed Greedy Initialization**: High-quality starting population
- **Smart Swap Mutation**: Fairness-aware repair bias
- **Tournament Selection**: Deb's feasibility rules for constraint handling
- **Adaptive Penalty**: Dynamic penalty coefficient based on feasibility history

## Reference

```bibtex
@inproceedings{li2021user,
  title={User-oriented Fairness in Recommendation},
  author={Yunqi Li, Hanxiong Chen, Zuohui Fu, Yingqiang Ge, and Yongfeng Zhang},
  booktitle={Proceedings of the the Web Conference 2021},
  year={2021}
}
```

## Requirements

Python 3.8+

Install dependencies:
```bash
pip install -r requirements.txt
```

Dependencies:
- `numpy` - Vectorized computations
- `pandas` - Data manipulation
- `pulp` - MILP optimization (HiGHS/CBC solver included)
- `matplotlib`, `seaborn` - Visualization
- `optuna` - Hyperparameter optimization (for tuning module)

## Datasets

- The processed datasets are in [`./dataset/`](./dataset/)
- **Amazon Datasets**: The origin dataset can be found [here](http://jmcauley.ucsd.edu/data/amazon/)
- For each dataset directory contains processed splitted testing datasets for re-ranking:
  - `0.05_count_*_test_ratings.txt`: grouping by total number of interactions
  - `sum_0.05_price_*_test_ratings.txt`: grouping by total consumption
  - `max_0.05_price_*_test_ratings.txt`: grouping by maximum price
- Sample rank files generated by NCF and biasedMF are provided under each dataset directory. Please decompress each `.tar.gz` file before running.

## Usage

### Prepare Input Data

Put the ranking file generated by your recommendation model under the corresponding dataset folder. For example, to run with 5Beauty-rand dataset, put the `*_rank.csv` file under `dataset/5Beauty-rand/` directory.

Ranking CSV file format: `uid \t iid \t score \t label`
- `uid`: user id
- `iid`: item id  
- `score`: predicted score
- `label`: 0 or 1 (negative or positive sample)

### MILP Solver

Run the Mixed Integer Linear Programming solver:

```bash
cd src/
python model.py
```

Configure in `model.py`:
- `dataset_name`, `model_name`, `group_name_title`
- `epsilon`: Fairness constraint threshold
- `solver`: Choose between `"highs"` or `"cbc"`

### Genetic Algorithm Optimizer

Run the GA optimizer:

```bash
cd src/
python ga_optimizer.py
```

Key parameters:
- `population_size`: Population size
- `generations`: Number of generations
- `mutation_rate`: Mutation rate
- `epsilon`: Fairness constraint

### Hyperparameter Tuning

Run automated hyperparameter optimization using Optuna:

```bash
cd src/
python ga_hyperparameter_tuning.py --dataset 5Beauty-rand --model biasedMF --group count --n-trials 50
```

Options:
- `--dataset`: Dataset name
- `--model`: Model name (biasedMF, NCF)
- `--group`: Grouping method (count, max_price, sum_price)
- `--n-trials`: Number of optimization trials
- `--timeout`: Maximum time in seconds

### Statistical Evaluation

Run multiple GA iterations for statistical analysis:

```bash
cd src/
python ga_statistical_evaluation.py --n-runs 30
```

Options:
- `--n-runs`: Number of runs per configuration (default: 30)
- `--datasets`: Specific datasets to evaluate
- `--models`: Specific models to evaluate

Results include mean, std, median, 95% CI, IQR, and success rate for all metrics.

## Results

Results are saved in `./results/` with subdirectories:
- `highs/`, `cbc/`: MILP solver outputs
- `tuning/`: Hyperparameter tuning results
- `statistical/`: GA Statistical evaluation results

## Project Structure

```
user-fairness/
â”œâ”€â”€ dataset/                    # Processed datasets
â”œâ”€â”€ results/                    # Output results
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ model.py               # MILP solver (PuLP/HiGHS/SCIP)
â”‚   â”œâ”€â”€ ga_optimizer.py        # Genetic Algorithm optimizer
â”‚   â”œâ”€â”€ ga_hyperparameter_tuning.py  # Optuna hyperparameter tuning
â”‚   â”œâ”€â”€ ga_statistical_evaluation.py # Statistical evaluation module
â”‚   â”œâ”€â”€ data_loader.py         # Data loading utilities
â”‚   â”œâ”€â”€ cache/                 # Vectorized data cache
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ tools.py           # Helper functions
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## License

This project is for research purposes. Please cite the original paper if you use this code.
